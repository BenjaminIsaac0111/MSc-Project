# Whole Slide Image Utilities

## Purpose
This repository contains various work in progress but functional utilities for processing aperio format.svs images into patches used to train machine learning model. The base code currently contains svs loader class for.svs images and associated.xml annotation files. This loader may be extended into more case specific utitlies. An initial example of this is the image patch extraction using point count annotation coordinates, often generated by pathologists to quantify components of tumour micro environment.

## Configuration
The svs loader(and child classes) may be used interactively (using the default con fig) or by configuration YAML files. The run_patch_extraction.py provides an idea on how the utilities may be implemented into a script and includes options for pool processing and specifying the configuration.

## Usage Example
### Using sample con fig to load svs files and the associated images.
The loader will walk the DATA_DIR specified in the configuration and build a listing of all the file paths under the directory. This listing can be searched using a regular expression (regex) to load a svs. The loader will attempt to find the associated files if these have matching id codes. If no codes match, then you may manually load an associated file using the loaders load_associated_file() method which will load the given file name or regex pattern.
Sample configuration.yaml
```
CACHE: 'cache\'
DATA_DIR: 'data\'
# r'w.*scores.xml' sample regex for WHOLE_scores.xml associated files.
ASSOCIATED_FILE_PATTERN: 'w.*scores.xml'
```

Using the loader:

```
from Processing import SVSLoader
loader = SVSLoader()
loader.load_svs(filename='102326.svs')
```
```
--- Loaded 102326.svs with 12 associated file(s) on PID 16456 ---
```
```
# Load the associated file using the regex in the config
loader.load_associated_file()
```
```
Using Loaded 102326_whole_scores.xml
```

### Patch Extraction example:
```
from Processing import PatchExtractor
loader = SVSLoader()
loader.load_svs(filename='102326.svs')
```
```
--- Loaded 102326.svs with 12 associated file(s) on PID 16456 ---
```
```
loader.load_associated_file()
```
```
Using Loaded 102326_whole_scores.xml
```
```
patch_extractor.extract_points()
patch_extractor.extract_patches()
patch_extractor.close_svs()
```

## Disclaimer
This code base is still in early development and is subject to change. 

